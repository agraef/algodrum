#N canvas 787 229 855 646.062 10;
#X floatatom 16 98 5 0 0 2 num #0-num -, f 5;
#X floatatom 53 98 5 0 0 2 unit #0-unit -, f 5;
#X floatatom 90 98 5 0 0 2 div #0-div -, f 5;
#X floatatom 127 98 5 0 0 2 bpm #0-bpm -, f 5;
#X obj 374 294 loadbang;
#X msg 374 316 4 4 1 120;
#X obj 374 338 unpack f f f f;
#X obj 53 120 / 4;
#X obj 127 168 *;
#X obj 127 119 t b f;
#X floatatom 72 185 5 0 0 1 ppm - -, f 5;
#X obj 72 206 swap 60000;
#X obj 72 228 /;
#X floatatom 72 250 5 0 0 1 dur - -, f 5;
#X obj 173 98 tgl 15 0 empty \$0-int empty 17 7 0 10 #3cc840 #000000
#000000 0 1;
#X obj 21 291 metro 500;
#X obj 21 313 bng 15 50 50 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 21 333 f;
#X obj 51 333 + 1;
#X obj 81 333 mod 4;
#X obj 90 143 *;
#X obj 16 162 *;
#X floatatom 16 184 5 0 0 1 ppb - -, f 5;
#X floatatom 21 355 5 0 0 0 - - -, f 5;
#X obj 217 251 inlet;
#X obj 375 251 inlet;
#X obj 217 295 unpack f f f;
#X floatatom 217 326 5 0 0 0 - - -, f 5;
#X floatatom 251 326 5 0 0 0 - - -, f 5;
#X floatatom 286 326 5 0 0 0 - - -, f 5;
#X obj 217 273 list append 1;
#X obj 21 376 / 1;
#X floatatom 21 398 5 0 0 0 - - -, f 5;
#X obj 194 408 outlet;
#X obj 442 251 inlet;
#X obj 265 408 outlet;
#X obj 336 408 outlet;
#X obj 375 273 s \$0-bpm;
#X obj 455 403 s \$0-bpm;
#X obj 217 347 s \$0-num;
#X obj 251 367 s \$0-unit;
#X obj 286 347 s \$0-div;
#X obj 374 362 s \$0-num;
#X obj 401 382 s \$0-unit;
#X obj 428 362 s \$0-div;
#X obj 173 69 tgl 15 0 empty \$0-jack jack -28 5 0 10 #fc3850 #000000
#000000 0 1;
#X symbolatom 79 68 10 0 0 0 - - -, f 10;
#X obj 202 28 jacktime;
#X floatatom 420 120 5 0 0 2 num - -, f 5;
#X floatatom 457 120 5 0 0 2 unit - -, f 5;
#X floatatom 494 120 5 0 0 2 ppq - -, f 5;
#X floatatom 531 120 5 0 0 2 bpm - -, f 5;
#X obj 258 50 unpack f f f f f f f;
#X obj 531 143 s \$0-bpm;
#X obj 420 144 s \$0-num;
#X obj 457 164 s \$0-unit;
#X obj 134 333 change;
#X floatatom 134 355 5 0 0 0 - - -, f 5;
#X obj 442 273 route int jack;
#X obj 442 295 s \$0-int;
#X obj 482 317 s \$0-jack;
#X obj 192 141 sel 1;
#X msg 192 163 0;
#X obj 192 185 s \$0-jack;
#X obj 266 141 sel 1;
#X msg 266 163 0;
#X obj 239 117 t f f;
#X obj 266 185 s \$0-int;
#X text 187 234 meter: num unit [div];
#X text 379 234 bpm;
#X text 439 234 int/jack toggle;
#X text 201 423 beat;
#X text 329 423 dur (metro tick);
#X text 250 423 num (meter);
#X obj 79 13 loadbang;
#X msg 79 35 symbol stopped;
#X obj 98 278 change;
#X obj 136 238 change;
#X obj 134 376 bng 15 50 50 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 322 131 swap;
#X floatatom 378 166 5 0 0 2 beats - -, f 5;
#X floatatom 323 166 5 0 0 2 ticks - -, f 5;
#X obj 323 187 / 1920;
#X obj 323 209 * 1;
#X obj 323 231 int;
#X obj 323 253 / 1;
#X obj 356 209 t f f;
#X obj 323 275 +;
#X obj 378 187 - 1;
#X obj 523 294 s \$0-jtime;
#X obj 202 5 r \$0-jtime;
#X obj 320 300 r div;
#N canvas 471 316 568 503.031 div 0;
#X obj 20 160 t b f;
#X obj 20 20 inlet;
#X obj 20 200 outlet;
#X obj 79 200 outlet;
#X obj 20 70 pack f f;
#X msg 20 95 \$2 \$1;
#X obj 20 120 route 0 1 2;
#X obj 200 150 int;
#X obj 200 175 ==;
#X obj 20 45 change;
#X obj 140 50 t b f;
#X msg 140 75 2;
#X obj 200 20 r \$0-beat;
#X obj 200 45 pack f f;
#X msg 200 70 \$2 \$1;
#X obj 200 95 route 2;
#X obj 200 200 sel 1;
#X obj 300 20 f;
#X obj 300 45 t f b;
#X msg 327 70 1;
#X obj 90 50 t f f;
#X obj 370 100 r \$0-numval;
#X obj 300 180 + 1;
#X obj 300 205 mod;
#X obj 300 130 f;
#X obj 200 120 t f f f;
#X obj 300 230 s \$0-ctr;
#X obj 90 20 r \$0-intval;
#X obj 327 130 * 4;
#X obj 300 100 t f b f f;
#X obj 300 155 *;
#X text 20 260 This stuff is complicated. Essentially \, what we do
here is to defer a division change until the next non-fractional beat
occurs \, at which point we also have to update the internal beat counter.
This only happens if the internal timer is on \, in which case we enter
"listen" state 1 and we go to "wait" state 2 when we receive a division
change \, and back again to state 1 once the division change has been
executed. Otherwise \, if the internal timer is off \, we enter "immediate"
state 0 in which division changes are output immediately. Note that
immediate state will not work properly if the internal timer is rolling
because the internal beat counter would be messed up \, usually resulting
in skipped beats., f 71;
#X connect 0 0 2 0;
#X connect 0 1 3 0;
#X connect 1 0 9 0;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 6 0 0 0;
#X connect 6 1 10 0;
#X connect 6 2 10 0;
#X connect 7 0 8 0;
#X connect 8 0 16 0;
#X connect 9 0 4 0;
#X connect 10 0 11 0;
#X connect 10 1 17 1;
#X connect 11 0 20 0;
#X connect 12 0 13 0;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 25 0;
#X connect 16 0 17 0;
#X connect 17 0 18 0;
#X connect 18 0 29 0;
#X connect 18 1 19 0;
#X connect 19 0 20 0;
#X connect 20 0 4 1;
#X connect 20 1 13 1;
#X connect 21 0 28 1;
#X connect 22 0 23 0;
#X connect 23 0 26 0;
#X connect 24 0 30 0;
#X connect 25 0 7 0;
#X connect 25 1 8 1;
#X connect 25 2 24 1;
#X connect 27 0 20 0;
#X connect 28 0 23 1;
#X connect 29 0 0 0;
#X connect 29 1 24 0;
#X connect 29 2 30 1;
#X connect 29 3 28 0;
#X connect 30 0 22 0;
#X restore 87 120 pd div;
#X obj 136 263 t f f;
#X obj 140 300 s \$0-numval;
#X obj 21 422 t f f;
#X obj 80 410 s \$0-beat;
#X obj 173 118 t f f f;
#X obj 230 80 s \$0-intval;
#X obj 70 310 r \$0-ctr;
#X text 210 210 midi clock;
#N canvas 903 354 450 300 clock 0;
#X obj 20 30 r mclk;
#X obj 80 30 r mclks;
#X obj 80 55 change;
#X msg 80 120 0;
#X obj 80 80 t f f;
#X msg 120 120 set \$1;
#X obj 120 145 s \$0-int;
#X obj 20 180 outlet;
#X obj 80 180 outlet;
#X connect 0 0 7 0;
#X connect 1 0 2 0;
#X connect 2 0 4 0;
#X connect 3 0 8 0;
#X connect 4 0 3 0;
#X connect 4 1 5 0;
#X connect 5 0 6 0;
#X restore 150 210 pd clock;
#X obj 420 210 r init-recall;
#N canvas 670 344 450 300 store 0;
#X obj 10 80 s num-store;
#X obj 110 80 s unit-store;
#X obj 60 110 s div-store;
#X obj 160 110 s bpm-store;
#X obj 10 20 inlet;
#X obj 60 20 inlet;
#X obj 110 20 inlet;
#X obj 160 20 inlet;
#X obj 10 50 spigot;
#X obj 322 32 loadbang;
#X obj 322 57 del 250;
#X msg 322 82 1;
#X obj 322 107 t f f f f;
#X obj 60 50 spigot;
#X obj 110 50 spigot;
#X obj 160 50 spigot;
#X connect 4 0 8 0;
#X connect 5 0 13 0;
#X connect 6 0 14 0;
#X connect 7 0 15 0;
#X connect 8 0 0 0;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 12 0 8 1;
#X connect 12 1 13 1;
#X connect 12 2 14 1;
#X connect 12 3 15 1;
#X connect 13 0 2 0;
#X connect 14 0 1 0;
#X connect 15 0 3 0;
#X restore 320 20 pd store;
#X msg 48 270 0;
#X obj 21 248 t f b;
#X obj 350 80 change;
#X obj 400 80 change;
#X obj 460 80 change;
#X obj 510 80 change;
#X connect 0 0 21 0;
#X connect 0 0 77 0;
#X connect 0 0 103 0;
#X connect 1 0 7 0;
#X connect 1 0 103 2;
#X connect 2 0 86 0;
#X connect 2 0 92 0;
#X connect 2 0 103 1;
#X connect 3 0 9 0;
#X connect 3 0 103 3;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 6 0 42 0;
#X connect 6 1 43 0;
#X connect 6 2 44 0;
#X connect 6 3 38 0;
#X connect 7 0 20 0;
#X connect 8 0 10 0;
#X connect 9 0 8 0;
#X connect 9 1 8 1;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 11 1 12 1;
#X connect 12 0 13 0;
#X connect 13 0 15 1;
#X connect 13 0 76 0;
#X connect 14 0 97 0;
#X connect 15 0 16 0;
#X connect 16 0 17 0;
#X connect 17 0 18 0;
#X connect 17 0 23 0;
#X connect 18 0 19 0;
#X connect 19 0 17 1;
#X connect 20 0 8 0;
#X connect 21 0 22 0;
#X connect 22 0 19 1;
#X connect 23 0 31 0;
#X connect 24 0 30 0;
#X connect 25 0 37 0;
#X connect 26 0 27 0;
#X connect 26 1 28 0;
#X connect 26 2 29 0;
#X connect 27 0 39 0;
#X connect 28 0 40 0;
#X connect 29 0 41 0;
#X connect 30 0 26 0;
#X connect 31 0 32 0;
#X connect 32 0 95 0;
#X connect 34 0 58 0;
#X connect 45 0 66 0;
#X connect 47 1 46 0;
#X connect 47 2 52 0;
#X connect 48 0 54 0;
#X connect 49 0 55 0;
#X connect 50 0 82 1;
#X connect 51 0 53 0;
#X connect 52 1 79 0;
#X connect 52 2 79 1;
#X connect 52 3 106 0;
#X connect 52 4 107 0;
#X connect 52 5 108 0;
#X connect 52 6 109 0;
#X connect 56 0 57 0;
#X connect 57 0 32 0;
#X connect 57 0 78 0;
#X connect 58 0 59 0;
#X connect 58 1 60 0;
#X connect 58 2 89 0;
#X connect 61 0 62 0;
#X connect 62 0 63 0;
#X connect 64 0 65 0;
#X connect 65 0 67 0;
#X connect 66 0 47 0;
#X connect 66 1 64 0;
#X connect 74 0 75 0;
#X connect 75 0 46 0;
#X connect 76 0 36 0;
#X connect 77 0 93 0;
#X connect 79 0 81 0;
#X connect 79 1 80 0;
#X connect 80 0 88 0;
#X connect 81 0 82 0;
#X connect 82 0 83 0;
#X connect 83 0 84 0;
#X connect 84 0 85 0;
#X connect 85 0 87 0;
#X connect 86 0 83 1;
#X connect 86 1 85 1;
#X connect 87 0 56 0;
#X connect 88 0 87 1;
#X connect 90 0 47 0;
#X connect 91 0 29 0;
#X connect 92 0 20 0;
#X connect 92 0 21 0;
#X connect 92 1 20 1;
#X connect 92 1 21 1;
#X connect 92 1 31 1;
#X connect 93 0 35 0;
#X connect 93 1 94 0;
#X connect 95 0 33 0;
#X connect 95 1 96 0;
#X connect 97 0 105 0;
#X connect 97 1 61 0;
#X connect 97 2 98 0;
#X connect 99 0 17 1;
#X connect 101 0 16 0;
#X connect 101 1 17 1;
#X connect 102 0 6 0;
#X connect 104 0 17 1;
#X connect 105 0 15 0;
#X connect 105 1 104 0;
#X connect 106 0 48 0;
#X connect 107 0 49 0;
#X connect 108 0 50 0;
#X connect 109 0 51 0;
#X coords 0 -1 1 1 183 54 1 10 64;
